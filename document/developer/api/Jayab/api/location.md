# مکان

مبنای کار این سیستم مکان است.


## جستجوی مکان

یافتن یک مکان با استفاده از فراخوانی زیر انجام می‌شود.

	/location/find

فراخوانی این متد باید با استفاده از GET انجام شود.

پارامترهای زیر برای انجام این فراخوانی در نظر گرفته شده است:

- latitude
- longitude
- radius

از این داده‌ها مختصات مکان جغرافیای الزامی است.

این فراخوانی با استفاده از روش صفحه بندی پیاده سازی شده است که در آن خصوصیت‌های زیر برای جستجو در نظر گرفته شده است:

- name
- description

خصوصیت‌های زیر برای مرتب سازی داده‌ها در نظر گرفته شده است:

- creation_date
- modif_dtime

نکته: برچسب‌ها به صورت یک آرایه ارسال می‌شود و مکانی که تمام این برچسب‌ها را داشته باشد  به عنوان نتیجه برگدانده خواهد شد. برچسب‌ها نیز با شناسه معرفی می‌شوند.

دو کلید زیر نیز برای تعیین کلید تگ و مقدار آن در نظر گرفته شده. به این ترتیب می‌توانید مکانهایی که با یک تگ خاص معرفی شده‌اند را به دست آورید:

- tag_key : کلید
- tag_value : مقدار


## فهرست مکان‌ها

یکی از پرکاربردترین کارهایی که در مدیریت مکان‌ها مورد نیاز است، فهرست و جستجوی مکانهایی است که در سیستم تعریف شده است. فراخوانی زیر برای فهرست کردن تمام‌مکانهایی به کار گرفته می‌شود و که کاربر سطح دسترسی به آنها را دارد. 

	/location/list

این فراخوانی باید با متد GET فراخوانی شود. این فراخوانی نیز از روش‌های صفحه بندی استفاده می‌کند. در این پیاده سازی قربالهای زیر تعریف شده است:

- reporter
- community

جستجو در فیلدهای زیر انجام می‌شود:

- name
- description

مرتب سازی نیز بر اساس خصوصیت‌های زیر انجام می‌شود:

- name
- creation_date
- modif_dtime

به صورت پیش فرض در این فهرست از خصوصیت‌های زیر برای مرتب کردن نتیجه‌های به دست آمده استفاده می‌شود:

	'creation_dtime', 'DESC'


## ایجاد یک مکان

یک مکان با استفاده از فراخوانی زیر یک مکان جدید برای کاربر ایجاد می‌شود:

	/location/create

این فراخوانی با متد POST باید فراخوانی شود و داده‌های زیر باید ارسال شود:

- name
- description
- latitude
- longitude

در نتیجه این درخواست اطلاعات کامل مکان ثبت شده به صورت یک شئی JSON برگردانده می‌شود.


## گرفتن اطلاعات یک مکان

برای گرفتن اطلاعات یک مکان فراخوانی زیر به کار گرفته می‌شود:

	/location/{location id}
	
این فراخوانی باید با استفاده از متد GET انجام شود. نمونه‌ای از خروجی این فراخوانی در زیر آورده شده است:

	{
	    "id": 1,
	    "reporter": 0,
	    "community": true,
	    "label": "",
	    "category": "",
	    "name": "\"example\"",
	    "description": "",
	    "latitude": "0.00000000",
	    "longitude": "0.00000000",
	    "creation_dtime": "2015-06-01 08:12:46",
	    "modif_dtime": "2015-06-01 08:12:46"
	}

## ویرایش یک مکان

برای ویرایش اطلاعات یک مکان فراخوانی زیر به کار گرفته می‌شود:

	/location/{location id}

این فراخوانی با متد POST باید به کار گرفته شود و اطلاعات جدید برای مکان تعیین شود. اطلاعاتی که از یک مکان می‌تواند به روز شود عبارت است از:

- name
- description
- latitude
- longitude

## حذف یک مکان

حذف یک مکان با استفاده از فراخوانی زیر انجام می‌شود.

	/location/{location id}

این فراخوانی با متد DELETE انجام می‌شود.

در نتیجه این فراخوانی نیز اطلاعات مکان ارسال خواهد شد.
 
 
# تگ‌های مکان

## اضافه کردن تگ

با استفاده از فراخوانی زیر یک تگ به یک مکان اضافه می‌شود

	/location/{location id}/tag/{tag id}

فراخوانی با متد POST باید استفاده شود. نکته اینکه این فراخوانی تنها یک رابطه بین تگ و مکان ایجاد می‌کند و تکرار آن هیچ تغییر در سیستم ایجاد نکرده و با خطا نیز روبرو نمی‌شود.

روش دیگر استفاده از اطلاعات برچسب برای این کار است. این فراخوانی به صورت زیر است:

	/location/{location id}/tag

با متد POST باید استفاده شود. اطلاعات برچسب به صورت زیر ارسال می‌شود:

- tag_key
- tag_value

نتیجه این فراخوانی خود داده‌های مکان است.

## حذف یک تگ

با استفاده از فراخوانی زیر می‌توان یک تگ را حذف کرد:

	/location/{location id}/tag/{tag id}

متد فراخوانی باید DELETE باشد.

روش دیگر برای حذف تگ به صورت زیر است

	/location/{location id}/tag

این فراخوانی نیز باید با استفاده از DELETE انجام شود. کلید‌هایی که برای تعیین تگ استفاده می‌شوند عبارتند از:

- tag_key
- tag_value

نتیجه این فراخوانی‌ها نیز ساختار داده‌ای مکان خواهد بود.

# برچسب‌های مکان

برای هر مکان یک یا چندین برچسب در نظر گرفته می‌شود.

برچسب گذاری یکی از ابتدایی ترین ابزارهایی است که در دسته بندی داده‌ها و ایجاد اطلاعات به کار گرفته می‌شود. 

از بسته pluf-km برای برچسب گذاری و ایجاد اطلاعات استفاه می‌شود، از این رو تمام واسطه‌های کاربری معرفی شده در این بسته نیز در اینجا کاربرد دارد.

در این بخش ابزارهای ارائه شده برای برچسب گذاری مکان‌ها معرفی شده است. تنها دسته‌ای از واسطه‌ها که در بسته مدیریت دانش وجود ندارد در اینجا توسعه داده شده است.

## فهرست برچسب‌ها

با استفاده از فراخوانی زیر فهرست تمام برچسب‌هایی که تا کنون به یک مکان زده شده تعیین می‌شود:

	/location/{location id}/label/list
	
این فراخوانی با متد GET باید انجام شود. نمونه‌ای از خروجی این فراخوانی در زیر آورده شده است:

	{
	  "0": {
	    "id": 20,
	    "user": 1,
	    "community": true,
	    "title": "maso",
	    "description": "",
	    "color": "5f000000",
	    "creation_dtime": "2015-06-01 18:01:33",
	    "modif_dtime": "2015-06-01 18:01:33"
	  },
	  "1": {
	    "id": 21,
	    "user": 1,
	    "community": true,
	    "title": "maso",
	    "description": "",
	    "color": "5f000000",
	    "creation_dtime": "2015-06-01 18:01:34",
	    "modif_dtime": "2015-06-01 18:01:34"
	  }
	}

## اضافه کردن برچسب

با استفاده از فراخوانی زیر یک برچسب به یک مکان اضافه می‌شود

	/location/{location id}/label/{label id}

فراخوانی با متد POST باید استفاده شود. نکته اینکه این فراخوانی تنها یک رابطه بین برچسب و مکان ایجاد می‌کند و تکرار آن هیچ تغییر در سیستم ایجاد نمی‌کند و با خطا نیز روبرو نمی‌شود.

## حذف یک برچسب

با فراخوانی زیر یک برچسب از یک مکان حذف می‌شود:

	/location/{location id}/label/{label id}

این فراخوانی با متد DELETE باید استفاده شود.

# رای دادن به مکان

هر کاربر می‌تواند به مکان‌های معرفی شده در سسیتم رای دهد. برای اینکار مجموعه‌ای از فراخوانی‌ها در نظر گرفته شده است که در این بخش آنها را به صورت کامل تشریح خواهیم کرد.

## رای به یک مکان

با استفاده از این فراخوانی یک رائ به یک مکان داده می‌شود

	/location/{location id}/vote
	
این فراخوانی با متد POST انجام می‌شود.

- like (true, false)

در صورتی که قبلا به این مکان رائ داده باشید، این فراخوانی برای به روز کردن رای به کار گرفته می‌شود.

## حذف رای

در این حالت، رای داده شده به یک مکان خاص حذف می‌شود. این فراخوان به صورت زیر است:

	/location/{location id}/vote

که با متد DELETE به کار گرفته می‌شود.

## تعیین آرای یک مکان

با استفاده از فراخوانی زیر می‌توان تعیین کرد که چه رائ‌هایی به یک مکان داده شده است:

	/location/{location id}/votes
	
این فراخوانی با متد GET انجام می‌شود. برای نمایش ارائه داده شده از یک ساختار خاص استفاده می‌شود که یک نمونه از آن در زیر آورده شده است:

	{
	  "like": "0",
	  "dislike": "1"
	} 


